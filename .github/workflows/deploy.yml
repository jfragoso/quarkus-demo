name: ðŸš€ Despliegue a MicroK8s

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Desplegar a MicroK8s
    runs-on: [self-hosted, linux]

    steps:
      - name: ðŸ“¥ Clonar repositorio
        uses: actions/checkout@v4

      - name: ðŸ”§ Exportar /snap/bin al PATH
        run: |
          echo "/snap/bin" >> $GITHUB_PATH
          export PATH=$PATH:/snap/bin

      - name: ðŸŸ¢ Verificar que MicroK8s estÃ¡ listo
        run: |
          sudo microk8s status --wait-ready

      - name: ðŸš¢ Aplicar manifiesto Deployment
        run: |
          sudo microk8s kubectl apply --validate=false -f k8s/deployment.yaml

      - name: ðŸš¢ Aplicar manifiesto Service
        run: |
          sudo microk8s kubectl apply --validate=false -f k8s/service.yaml

      - name: âœ… Verificar recursos desplegados
        run: |
          sudo microk8s kubectl get all -n default
